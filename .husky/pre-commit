#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# TypeScript check for server
echo "ğŸ“¦ Checking TypeScript in server..."
cd server && npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors in server!"
  exit 1
fi
cd ..

# TypeScript check for client
echo "ğŸ¨ Checking TypeScript in client..."
cd client && npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript errors in client!"
  exit 1
fi

# Lint-staged for client
echo "âœ¨ Running lint-staged for client..."
npx lint-staged
if [ $? -ne 0 ]; then
  echo "âŒ Linting errors!"
  exit 1
fi

# Run tests for client
echo "ğŸ§ª Running tests in client..."
npm run test:run
if [ $? -ne 0 ]; then
  echo "âŒ Tests failed!"
  echo "ğŸ’¡ Fix the tests before committing. Run 'npm test' to debug."
  exit 1
fi

cd ..
echo "âœ… All checks passed!"
